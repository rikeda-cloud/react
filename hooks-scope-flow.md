# React Hooksのスコープとデータフローの原則

`useState`, `useRef`などのフックで作成された状態や参照の基本的なスコープと、コンポーネント間のデータ受け渡しに関するルールをまとめます。

---

### 1. 基本的なスコープ

`useState`, `useRef`, `useReducer`などのフックは、すべて**「それが宣言されたコンポーネントの個々のインスタンス」**に紐づきます。

- 各コンポーネントのインスタンスは、それぞれが独立した状態や参照を持ちます。
- あるコンポーネントの状態が、他のインスタンスに影響を与えることはありません。

---

### 2. 親から子へのデータフロー (トップダウン)

Reactのデータフローは、常に親から子への一方向（トップダウン）が原則です。

- **受け渡し方法:** 親コンポーネントは、子コンポーネントに`props`（プロパティ）としてデータを渡します。
- **渡せるもの:** `useState`の状態の値、更新関数、`useRef`の参照オブジェクトなど、あらゆるデータを渡すことができます。
- **子から孫へ:** この原則はどの階層でも同じです。親→子→孫...と`props`を介してデータを「バケツリレー」のように渡していくことが可能です。ただし、階層が深くなると管理が煩雑になるため、その場合は`Context API`などの利用が推奨されます。

---

### 3. 子から親へのデータフロー (ボトムアップ)

トップダウンの原則に基づき、**子から親へデータを直接渡すことはできません。**

- **解決策: 「状態のリフトアップ (Lifting State Up)」**
  - これがReactの標準的な設計パターンです。
  - 複数のコンポーネントで共有したい状態がある場合、それらのコンポーネントの**最も近い共通の親**で状態を管理します。
  - 親で管理している状態と更新関数を、子に`props`として渡すことで、子が親の状態を更新できるようになります。

- **代替案: 「コールバック関数」**
  - 親コンポーネントで関数を定義し、その関数を子に`props`として渡します。
  - 子は、何かイベントが発生したタイミングで、受け取った親の関数を呼び出します。これにより、子のイベントや状態を親に「通知」することができます。

---

### 4. DOMへのアクセス: `forwardRef`

`forwardRef`は、これまでのデータフローとは少し目的が異なります。これは**状態（State）**ではなく、**DOMノード（HTML要素）**にアクセスするための特別な仕組みです。

- **目的:** 親コンポーネントが、子コンポーネント内にある特定のDOM要素（`<input>`, `<div>`など）を直接操作したい場合に使用します。
- **例:** 親のボタンで、子の`<input>`にフォーカスを当てる、など。
- **仕組み:** 親で作成した`ref`を、子コンポーネントに転送（forward）し、最終的に子コンポーネント内のDOM要素に紐付けます。

---

### まとめ表

| やりたいこと | 方法 | 説明 |
| :--- | :--- | :--- |
| **親 → 子** へデータを渡す | `props` | 基本的なデータフロー。状態、更新関数、refなどを渡す。 |
| **子 → 親** へデータを伝える | **状態のリフトアップ** | **推奨。** 状態を親で管理し、子に`props`で渡す。 |
| **子 → 親** へイベントを通知する | コールバック関数 | 親で定義した関数を子に渡し、子で実行してもらう。 |
| **親 → 子のDOM** を操作する | `forwardRef` | `ref`を子コンポーネントに転送し、DOMに直接アクセスする。 |
